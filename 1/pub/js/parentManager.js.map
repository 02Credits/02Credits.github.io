{"version":3,"sources":["parentManager.ts"],"names":[],"mappings":";;;IAgBA,iBAAwB,MAAsB,IAAsB,MAAM,CAAC,OAAO,IAAI,MAAM,CAAC,CAAC,CAAC;;IAE/F;QACE,yBAAM,CAAC,SAAS,CAAC;YACf,GAAG,CAAC,CAAC,IAAI,WAAW,IAAI,GAAG,CAAC,WAAW,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;gBACvD,IAAI,MAAM,GAAG,GAAG,CAAC,SAAS,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;gBAC/C,EAAE,CAAC,CAAC,2BAAY,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;oBACzB,IAAI,cAAc,GAAG,MAAM,CAAC,QAAQ,IAAI,CAAC,CAAC;oBAC1C,IAAI,WAAW,GAAG,MAAM,CAAC,KAAK,IAAI,CAAC,CAAC;oBACpC,IAAI,OAAO,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,CAAC;oBACrC,IAAI,OAAO,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,CAAC;oBACrC,gDAAgD;oBAChD,WAAW,CAAC,KAAK,CAAC,gBAAgB,GAAG,WAAW,CAAC,KAAK,CAAC,gBAAgB,IAAI,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAC,CAAC;oBAC9F,WAAW,CAAC,QAAQ,CAAC,CAAC;wBACpB,CAAC,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,GAAG,WAAW,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;4BAC/D,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,GAAG,WAAW,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,CAAC,GAAG,WAAW;4BAC/E,OAAO,CAAC;oBACV,WAAW,CAAC,QAAQ,CAAC,CAAC;wBACpB,CAAC,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,GAAG,WAAW,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;4BAC/D,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,GAAG,WAAW,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,CAAC,GAAG,WAAW;4BAC/E,OAAO,CAAC;oBACV,WAAW,CAAC,KAAK,CAAC,gBAAgB,GAAG,WAAW,CAAC,KAAK,CAAC,gBAAgB,IAAI,CAAC,CAAC;oBAC7E,WAAW,CAAC,QAAQ,GAAG,WAAW,CAAC,KAAK,CAAC,gBAAgB,GAAG,cAAc,CAAC;oBAC3E,WAAW,CAAC,KAAK,CAAC,aAAa,GAAG,WAAW,CAAC,KAAK,CAAC,aAAa,IAAI,CAAC,CAAC;oBACvE,WAAW,CAAC,KAAK,GAAG,WAAW,CAAC,KAAK,CAAC,aAAa,GAAG,WAAW,CAAC;oBAClE,0EAA0E;oBAC1E,8EAA8E;oBAC9E,EAAE,CAAC,CAAC,SAAS,IAAI,MAAM,CAAC,CAAC,CAAC;wBACxB,WAAW,CAAC,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC;oBACvC,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACN,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC;oBAC7B,CAAC;gBACH,CAAC;YACH,CAAC;QACH,CAAC,CAAC,CAAC;IACL,CAAC;;;;;;;;;;;;;;;;QACD,CAAC","file":"parentManager.js","sourcesContent":["import * as ces from \"./ces\"\r\nimport {Update} from \"./animationManager\";\r\nimport {Entity as RenderableEntity, isRenderable} from \"./webglManager\";\r\nimport utils from \"./utils\";\r\nimport {CombinedEntity} from \"./entity\";\r\n\r\nexport interface Entity extends RenderableEntity {\r\n  child: {\r\n    relativePosition?: utils.Point,\r\n    relativeRotation?: number,\r\n    relativeScale?: number,\r\n    relativeAlpha?: number\r\n  },\r\n  parent: string,\r\n  enabled?: boolean\r\n}\r\nexport function isChild(entity: CombinedEntity): entity is Entity { return \"child\" in entity; }\r\n\r\nexport function setup() {\r\n  Update.Subscribe(() => {\r\n    for (let childEntity of ces.getEntities(isChild, true)) {\r\n      let parent = ces.getEntity(childEntity.parent);\r\n      if (isRenderable(parent)) {\r\n        let parentRotation = parent.rotation || 0;\r\n        let parentScale = parent.scale || 1;\r\n        let parentX = parent.position.x || 0;\r\n        let parentY = parent.position.y || 0;\r\n        // let parentAlpha = parent.rendered.alpha || 1;\r\n        childEntity.child.relativePosition = childEntity.child.relativePosition || {x: 0, y: 0, z: 0};\r\n        childEntity.position.x =\r\n          (Math.cos(parentRotation) * childEntity.child.relativePosition.x -\r\n           Math.sin(parentRotation) * childEntity.child.relativePosition.y) * parentScale +\r\n          parentX;\r\n        childEntity.position.y =\r\n          (Math.sin(parentRotation) * childEntity.child.relativePosition.x +\r\n           Math.cos(parentRotation) * childEntity.child.relativePosition.y) * parentScale +\r\n          parentY;\r\n        childEntity.child.relativeRotation = childEntity.child.relativeRotation || 0;\r\n        childEntity.rotation = childEntity.child.relativeRotation + parentRotation;\r\n        childEntity.child.relativeScale = childEntity.child.relativeScale || 1;\r\n        childEntity.scale = childEntity.child.relativeScale * parentScale;\r\n        // childEntity.child.relativeAlpha = childEntity.child.relativeAlpha || 1;\r\n        // childEntity.rendered.alpha = childEntity.child.relativeAlpha * parentAlpha;\r\n        if (\"enabled\" in parent) {\r\n          childEntity.enabled = parent.enabled;\r\n        } else {\r\n          childEntity.enabled = true;\r\n        }\r\n      }\r\n    }\r\n  });\r\n}\r\n"]}