{"version":3,"sources":["inputManager.ts"],"names":[],"mappings":";;;IAYA,2BAA2B,CAAa;QACtC,YAAY,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC,OAAO,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;QAC1C,YAAY,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,OAAO,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;QAClD,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,OAAO,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;QACnD,cAAc,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC;QAC9B,cAAc,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC;IAChC,CAAC;IAED;QACE,OAAO,CAAC,KAAK,EAAE,CAAC;QAChB,OAAO,GAAG,IAAI,CAAC;IACjB,CAAC;IAED;QACE,OAAO,GAAG,KAAK,CAAC;IAClB,CAAC;IAED,sBAAsB,CAAgB;QACpC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;IACtB,CAAC;IAED,wBAAwB,CAAgB;QACtC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;IACrB,CAAC;IAED,iBAAwB,GAAW;QACjC,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YACd,MAAM,CAAC,IAAI,CAAC;QACd,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,MAAM,CAAC,KAAK,CAAC;QACf,CAAC;IACH,CAAC;;IAED;QACE,8GAA8G;QAC9G,IAAI,MAAM,GAAG,GAAG,CAAC,WAAW,CAAC,wBAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;QAC1C,IAAI,gBAAgB,GAAG,CAAC,yBAAU,EAAE,yBAAU,CAAC,CAAC;QAChD,MAAM,CAAC;YACL,YAAY,EAAE,YAAY;YAC1B,QAAQ,EAAE,YAAI,CAAC,YAAI,CAAC,WAAG,CAAC,cAAc,EAAE,aAAK,CAAC,gBAAgB,EAAE,GAAG,CAAC,CAAC,EAAE,cAAM,CAAC,MAAM,CAAC,UAAU,EAAE,yBAAU,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YACvH,OAAO,EAAE,OAAO;SACjB,CAAC;IACJ,CAAC;;IAED;QACE,OAAO,GAAG,QAAQ,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;QAE1C,OAAO,CAAC,gBAAgB,CAAC,SAAS,EAAE,iBAAiB,CAAC,CAAC;QACvD,OAAO,CAAC,gBAAgB,CAAC,WAAW,EAAE,iBAAiB,CAAC,CAAC;QACzD,OAAO,CAAC,gBAAgB,CAAC,WAAW,EAAE,iBAAiB,CAAC,CAAC;QAEzD,OAAO,CAAC,gBAAgB,CAAC,SAAS,EAAE,cAAc,CAAC,CAAC;QACpD,OAAO,CAAC,gBAAgB,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;QAEhD,OAAO,CAAC,gBAAgB,CAAC,YAAY,EAAE,iBAAiB,CAAC,CAAC;QAC1D,OAAO,CAAC,gBAAgB,CAAC,YAAY,EAAE,iBAAiB,CAAC,CAAC;IAC5D,CAAC;;;;;;;;;;;;;;;;;;;YA/DG,IAAI,GAA+B,EAAE,CAAC;YACtC,YAAY,GAA+B,EAAE,CAAC;YAC9C,OAAO,GAAG,KAAK,CAAC;YAChB,SAAS,GAAG,KAAK,CAAC;YAClB,cAAc,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QA4D5B,CAAC","file":"inputManager.js","sourcesContent":["import * as ces from \"./ces\";\r\nimport {sub, mult, scale, shrink} from \"./utils\";\r\nimport {isCamera} from \"./cameraManager\";\r\nimport {canvasSize} from \"./webglManager\";\r\n\r\nlet keys: { [key: string]: boolean } = {};\r\nlet mouseButtons: { [key: string]: boolean } = {};\r\nlet enabled = false;\r\nlet mouseDown = false;\r\nlet mouseScreenPos = [0, 0];\r\nlet gameDiv: HTMLElement;\r\n\r\nfunction mouseEventHandler(e: MouseEvent) {\r\n  mouseButtons.left = (e.buttons & 1) === 1;\r\n  mouseButtons.right = ((e.buttons >> 1) & 1) === 1;\r\n  mouseButtons.middle = ((e.buttons >> 2) & 1) === 1;\r\n  mouseScreenPos[0] = e.offsetX;\r\n  mouseScreenPos[1] = e.offsetY;\r\n}\r\n\r\nfunction mouseEnterHandler() {\r\n  gameDiv.focus();\r\n  enabled = true;\r\n}\r\n\r\nfunction mouseLeaveHandler() {\r\n  enabled = false;\r\n}\r\n\r\nfunction keyUpHandler(e: KeyboardEvent) {\r\n  keys[e.key] = false;\r\n}\r\n\r\nfunction keyDownHandler(e: KeyboardEvent) {\r\n  keys[e.key] = true;\r\n}\r\n\r\nexport function KeyDown(key: string) {\r\n  if (keys[key]) { // Yes this is dumb. This is to handle if the key hasn't been pressed before\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport function MouseState() {\r\n  // NOTE I should probably change this to not do the transform here and instead leave it to the pixi Manager...\r\n  let camera = ces.getEntities(isCamera)[0];\r\n  let canvasDimensions = [canvasSize, canvasSize];\r\n  return {\r\n    mouseButtons: mouseButtons,\r\n    position: mult(mult(sub(mouseScreenPos, scale(canvasDimensions, 0.5)), shrink(camera.dimensions, canvasSize)), [1, -1]),\r\n    enabled: enabled\r\n  };\r\n}\r\n\r\nexport function setup() {\r\n  gameDiv = document.getElementById(\"game\");\r\n\r\n  gameDiv.addEventListener(\"mouseup\", mouseEventHandler);\r\n  gameDiv.addEventListener(\"mousedown\", mouseEventHandler);\r\n  gameDiv.addEventListener(\"mousemove\", mouseEventHandler);\r\n\r\n  gameDiv.addEventListener(\"keydown\", keyDownHandler);\r\n  gameDiv.addEventListener(\"keyup\", keyUpHandler);\r\n\r\n  gameDiv.addEventListener(\"mouseenter\", mouseEnterHandler);\r\n  gameDiv.addEventListener(\"mouseleave\", mouseLeaveHandler);\r\n}\r\n"]}