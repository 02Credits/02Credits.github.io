{"version":3,"sources":["inputManager.ts"],"names":[],"mappings":"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","file":"inputManager.js","sourcesContent":["import * as ces from \"./ces\";\r\nimport {sub, mult, div, scale, shrink, flatten, Point} from \"./utils\";\r\nimport {isCamera} from \"./cameraManager\";\r\nimport {canvasDimensions, visibleDimensions} from \"./webglManager\";\r\n\r\nlet keys: { [key: string]: boolean } = {};\r\nlet mouseButtons: { [key: string]: boolean } = {};\r\nlet enabled = false;\r\nlet mouseDown = false;\r\nlet mouseScreenPos = {x: 0, y: 0, z: 0};\r\nlet gameDiv: HTMLElement;\r\n\r\nfunction mouseEventHandler(e: MouseEvent) {\r\n  mouseButtons.left = (e.buttons & 1) === 1;\r\n  mouseButtons.right = ((e.buttons >> 1) & 1) === 1;\r\n  mouseButtons.middle = ((e.buttons >> 2) & 1) === 1;\r\n  mouseScreenPos.x = e.offsetX;\r\n  mouseScreenPos.y = e.offsetY;\r\n}\r\n\r\nfunction mouseEnterHandler() {\r\n  gameDiv.focus();\r\n  enabled = true;\r\n}\r\n\r\nfunction mouseLeaveHandler() {\r\n  enabled = false;\r\n}\r\n\r\nfunction keyUpHandler(e: KeyboardEvent) {\r\n  keys[e.key] = false;\r\n}\r\n\r\nfunction keyDownHandler(e: KeyboardEvent) {\r\n  keys[e.key] = true;\r\n}\r\n\r\nexport function KeyDown(key: string) {\r\n  if (keys[key]) { // Yes this is dumb. This is to handle if the key hasn't been pressed before\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport function MouseState() {\r\n  // NOTE I should probably change this to not do the transform here and instead leave it to the pixi Manager...\r\n  let camera = ces.getEntities(isCamera)[0];\r\n  let mousePos: Point;\r\n  if (visibleDimensions.x != 0) {\r\n    // (mP - (vD * 0.5)) * (cD / canvasSize) * {1, -1, 0}\r\n    mousePos = flatten(mult(mult(\r\n      sub(mouseScreenPos, scale(visibleDimensions, 0.5)),\r\n      div(camera.dimensions, visibleDimensions)), {x: 1, y: -1, z: 0}));\r\n    console.log(mousePos);\r\n  } else {\r\n    mousePos = {x: 0, y: 0, z: 0};\r\n  }\r\n  return {\r\n    mouseButtons: mouseButtons,\r\n    position: mousePos,\r\n    enabled: enabled\r\n  };\r\n}\r\n\r\nexport function setup() {\r\n  gameDiv = document.getElementById(\"game\");\r\n\r\n  document.addEventListener(\"mouseup\", mouseEventHandler);\r\n  document.addEventListener(\"mousedown\", mouseEventHandler);\r\n  document.addEventListener(\"mousemove\", mouseEventHandler);\r\n\r\n  document.addEventListener(\"keydown\", keyDownHandler);\r\n  document.addEventListener(\"keyup\", keyUpHandler);\r\n\r\n  document.addEventListener(\"mouseenter\", mouseEnterHandler);\r\n  document.addEventListener(\"mouseleave\", mouseLeaveHandler);\r\n}\r\n"]}