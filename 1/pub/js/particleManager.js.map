{"version":3,"sources":["particleManager.ts"],"names":[],"mappings":";;;IAcA,qBAA4B,MAAsB,IAAsB,MAAM,CAAC,mBAAmB,IAAI,MAAM,CAAC,CAAC,CAAC;;IAI/G,sBAAsB,MAAW,EAAE,MAAW;QAC5C,GAAG,CAAC,CAAC,IAAI,EAAE,IAAI,MAAM,CAAC,CAAC,CAAC;YACtB,EAAE,CAAC,CAAC,EAAE,IAAI,MAAM,CAAC,CAAC,CAAC;gBACjB,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC7C,MAAM,CAAC,EAAE,CAAC,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC;gBAC3B,CAAC;gBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,OAAO,MAAM,CAAC,EAAE,CAAC,IAAI,QAAQ,IAAI,OAAO,MAAM,CAAC,EAAE,CAAC,IAAI,QAAQ,CAAC,CAAC,CAAC;oBAC1E,YAAY,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC;gBACvC,CAAC;YACH,CAAC;QACH,CAAC;IACH,CAAC;IAED;QACE,yBAAM,CAAC,SAAS,CAAC,CAAC,IAAI;YACpB,IAAI,iBAAiB,GAAG,GAAG,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;YAErD,GAAG,CAAC,CAAC,IAAI,MAAM,IAAI,iBAAiB,CAAC,CAAC,CAAC;gBACrC,IAAI,SAAS,GAAG,MAAM,CAAC,iBAAiB,CAAC;gBACzC,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC;oBAC7B,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,OAAO,GAAG,SAAS,CAAC,SAAS,GAAG,GAAG,CAAC,CAAC,CAAC;wBACxD,IAAI,cAAc,GAAG,EAAE,CAAC;wBACxB,IAAI,aAAa,GAAG,EAAE,CAAC;wBACvB,IAAI,WAAW,GAAG,EAAE,CAAC;wBACrB,qCAAc,CAAC,SAAS,CAAC,QAAQ,EAAE,cAAc,CAAC,CAAC;wBACnD,qCAAc,CAAC,SAAS,CAAC,aAAa,EAAE,aAAa,CAAC,CAAC;wBACvD,YAAY,CAAC,MAAM,EAAE,aAAa,CAAC,CAAC;wBACpC,qCAAc,CAAC,SAAS,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;wBACnD,YAAY,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;wBAClC,GAAG,CAAC,SAAS,mBAAK,cAAc,EAAK,aAAa,IAAE,cAAc,EAAE;gCAClE,KAAK,EAAE,aAAa;gCACpB,GAAG,EAAE,WAAW;gCAChB,MAAM,EAAE,SAAS,CAAC,MAAM;gCACxB,IAAI,EAAE,IAAI;6BACX,IAAE,CAAC;oBACN,CAAC;gBACH,CAAC;YACH,CAAC;QACH,CAAC,CAAC,CAAA;IACJ,CAAC;;;;;;;;;;;;;;;;QAED,CAAC","file":"particleManager.js","sourcesContent":["import {CombinedEntity} from \"./entity\";\r\nimport {Update} from \"./animationManager\";\r\nimport * as ces from \"./ces\";\r\nimport {collapseTarget} from \"./interpolationManager\";\r\n\r\nexport interface Entity {\r\n  particleGenerator: {\r\n    relativeStart: any;\r\n    relativeEnd: any;\r\n    constant: any;\r\n    length: number;\r\n    frequency: number;\r\n  }\r\n}\r\nexport function isGenerator(entity: CombinedEntity): entity is Entity { return \"particleGenerator\" in entity; }\r\n\r\n\r\n\r\nfunction makeRelative(entity: any, target: any) {\r\n  for (let id in target) {\r\n    if (id in entity) {\r\n      if (!isNaN(target[id]) || !isNaN(entity[id])) {\r\n        target[id] += entity[id];\r\n      } else if (typeof entity[id] == \"object\" && typeof target[id] == \"object\") {\r\n        makeRelative(entity[id], target[id]);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function Setup() {\r\n  Update.Subscribe((time) => {\r\n    let generatorEntities = ces.GetEntities(isGenerator);\r\n\r\n    for (let entity of generatorEntities) {\r\n      let generator = entity.particleGenerator;\r\n      for (let i = 0; i < 100; i++) {\r\n        if (Math.random() < 0.01666 * generator.frequency / 100) {\r\n          let constantValues = {};\r\n          let relativeStart = {};\r\n          let relativeEnd = {};\r\n          collapseTarget(generator.constant, constantValues);\r\n          collapseTarget(generator.relativeStart, relativeStart);\r\n          makeRelative(entity, relativeStart);\r\n          collapseTarget(generator.relativeEnd, relativeEnd);\r\n          makeRelative(entity, relativeEnd);\r\n          ces.AddEntity({...constantValues, ...relativeStart, \"interpolated\": {\r\n            start: relativeStart,\r\n            end: relativeEnd,\r\n            length: generator.length,\r\n            kill: true\r\n          }});\r\n        }\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\n"]}