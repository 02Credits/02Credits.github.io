// Generated by CoffeeScript 1.12.0
(function() {
  define(["jquery", "mithril", "arbiter"], function($, m, arbiter) {
    var cardHeight, cardWidth, cards, clickCard, closeCards, openCards, render, spacing;
    cards = ["http://i.imgur.com/aZ7GpiQ.png", "http://i.imgur.com/xmbl34o.jpg", "http://i.imgur.com/dVWdko8.jpg", "http://i.imgur.com/DieNi7L.jpg", "http://i.imgur.com/a1epPuB.jpg", "http://i.imgur.com/DIl4w3p.gif", "http://i.imgur.com/cPwAnaL.jpg", "http://i.imgur.com/doHAiPD.jpg", "http://i.imgur.com/FCKBSP0.jpg"];
    spacing = 40;
    cardWidth = 168;
    cardHeight = 244;
    closeCards = function(e) {
      $('.memeCard').css({
        'right': ""
      });
      $('.memeCard').removeClass('open');
      return e.stopPropagation();
    };
    openCards = function() {
      return $('.memeCard').each(function(i) {
        $(this).css({
          'right': (spacing * i + cardWidth).toString() + "px"
        });
        return $(this).addClass('open');
      });
    };
    clickCard = function(card) {
      return function(e) {
        var cardElement;
        if (e.target.className.indexOf('open') !== -1) {
          cardElement = '<img src="#{card}" width="260px" style="margin: 0px -10px -11px -10px">';
          arbiter.publish("messages/send", {
            text: cardElement,
            author: localStorage.displayName
          });
          closeCards(e);
        } else {
          openCards();
        }
        return e.stopPropagation();
      };
    };
    if (localStorage.cardsEnabled == null) {
      localStorage.cardsEnabled = true;
    }
    if (localStorage.cardsEnabled) {
      $('#cards-enabled').prop("checked", true);
      $('.memeCard').show();
    } else {
      $('#cards-enabled').prop("checked", false);
      $('.memeCard').hide();
    }
    $('#cards-enabled').click(function() {
      if (this.checked) {
        localStorage.cardsEnabled = true;
        return $('.memeCard').show();
      } else {
        localStorage.cardsEnabled = false;
        return $('.memeCard').hide();
      }
    });
    return render = function() {
      var card, cardList;
      cardList = $('#card-list');
      $('body').click(closeCards);
      return m.render(cardList.get(0), (function() {
        var j, len, results;
        results = [];
        for (j = 0, len = cards.length; j < len; j++) {
          card = cards[j];
          results.push(m("img.memeCard", {
            src: card,
            onclick: clickCard(card)
          }));
        }
        return results;
      })());
    };
  });

}).call(this);
