// Generated by CoffeeScript 1.12.0
(function() {
  define(["jquery", "arbiter"], function($, arbiter) {
    var div;
    div = document.getElementById('content');
    div.ondragenter = div.ondragover = function(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'copy';
      return false;
    };
    return div.ondrop = function(e) {
      var blob, error, file, fileReader, i, len, ref, sent, url;
      try {
        url = e.dataTransfer.getData('URL');
        sent = false;
        if (url !== "") {
          sent = true;
          $('.progress').fadeIn();
          $.ajax({
            url: 'https://api.imgur.com/3/image',
            headers: {
              'Authorization': 'Client-ID c110ed33b325faf'
            },
            type: 'POST',
            data: {
              'image': url,
              'Authorization': 'Client-ID c110ed33b325faf'
            },
            success: function(result) {
              arbiter.publish('messages/send', {
                text: result.data.link,
                author: localStorage.displayName
              });
              return $('.progress').fadeOut();
            },
            error: function() {
              Materialize.toast("Image URL Upload Failed", 4000);
              return $('.progress').fadeOut();
            }
          });
        } else {
          if (e.dataTransfer.files.length !== 0) {
            fileReader = new FileReader;
            fileReader.onload = function() {
              return $.ajax({
                image: fileReader.result,
                headers: {
                  'Authorization': 'Client-ID c110ed33b325faf'
                },
                type: 'POST',
                datatype: "base64",
                success: function(result) {
                  return arbiter.publish('messages/send', {
                    text: result.data.link,
                    author: localStorage.displayName
                  });
                },
                error: function() {
                  return Materialize.toast("Image URL Upload Failed", 4000);
                }
              });
            };
            ref = e.dataTransfer.files;
            for (i = 0, len = ref.length; i < len; i++) {
              file = ref[i];
              if (file.type.match(/image.*/)) {
                blob = file.slice();
                fileReader.readAsBinaryString(blob);
              }
            }
          }
        }
      } catch (error1) {
        error = error1;
        arbiter.publish('error', error);
      }
      return e.preventDefault();
    };
  });

}).call(this);
